<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitech Factory E-commerce Platform</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM, and Babel for in-browser JSX compilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            direction: rtl;
            text-align: right;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// Lucide Icons as React components
const ShoppingCart = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-shopping-cart ${className}`}><circle cx="8" cy="21" r="1" /><circle cx="19" cy="21" r="1" /><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" /></svg>;
const Heart = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-heart ${className}`}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.76-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></svg>;
const Search = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-search ${className}`}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>;
const User = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-user ${className}`}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>;
const Menu = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-menu ${className}`}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></svg>;
const X = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-x ${className}`}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></svg>;
const ChevronLeft = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-chevron-left ${className}`}><path d="m15 18-6-6 6-6" /></svg>;
const Minus = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-minus ${className}`}><path d="M5 12h14" /></svg>;
const Plus = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-plus ${className}`}><path d="M5 12h14" /><path d="M12 5v14" /></svg>;
const Trash2 = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-trash-2 ${className}`}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></svg>;
const LogOut = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-log-out ${className}`}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></svg>;
const Package = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-package ${className}`}><path d="m7.5 4.27 9 5.15" /><path d="M21 8.5V19c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V8.5" /><path d="m3.85 6.06 12.63-7.23a1 1 0 0 1 1.12 0l7.26 4.16c.33.19.6.51.76.88.16.37.23.78.23 1.2s-.07.82-.23 1.19a1.05 1.05 0 0 1-.76.88L11.5 18.23a2.05 2.05 0 0 1-2.28 0L.85 10.15a1.05 1.05 0 0 1-.23-1.19c.16-.37.43-.69.76-.88L7.5 4.27Z" /><path d="m12 18.23-7.26-4.16" /></svg>;
const Edit = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-edit ${className}`}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></svg>;
const Save = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-save ${className}`}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></svg>;
const Upload = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-upload ${className}`}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></svg>;
const CheckCircle = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-check-circle ${className}`}><path d="M22 11.08V12a10 10 0 1 1-5.93-8.5" /><polyline points="22 4 12 14.01 9 11.01" /></svg>;
const MapPin = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-map-pin ${className}`}><path d="M12 21.35s-8-7.7-8-12a8 8 0 0 1 16 0c0 4.3-8 12-8 12z" /><circle cx="12" cy="12" r="3" /></svg>;
const Phone = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-phone ${className}`}><path d="M22 16.92v3a2 2 0 0 1-2.18 2.18A19.019 19.019 0 0 1 8.63 4.41A2 2 0 0 1 10.82 2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-3a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1-2-2h-3a2 2 0 0 1-2-2h-.18a2 2 0 0 0-2.18 2.18A19.019 19.019 0 0 0 8.63 19.59A2 2 0 0 0 10.82 22h3a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-1a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-3z" /></svg>;
const Facebook = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-facebook ${className}`}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" /></svg>;
const MessageCircle = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-message-circle ${className}`}><path d="M7.9 20.8A10 10 0 0 0 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2 2 6.48 2 12c0 1.57.37 3.06 1.05 4.41L2 22l5.9-1.2z" /></svg>;
const Sparkles = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-sparkles ${className}`}><path d="M9.9 14.9L12 17l2.1-2.1L17 12l-2.1-2.1L12 7l-2.1 2.1L7 12z" /><path d="M12 2v5.9M12 18.1V22M2 12h5.9M18.1 12H22M4.9 4.9l4.2 4.2M14.9 14.9l4.2 4.2M4.9 19.1l4.2-4.2M14.9 9.1l4.2-4.2" /></svg>;
const Star = ({ size = 24, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-star ${className}`}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></svg>;

// Initial mock data for the application
const initialMockData = {
  categories: [
    { id: '1', name: 'Cashier Paper Rolls', name_ar: 'لفافات ورق الكاشير' },
    { id: '2', name: 'Fawry Rolls', name_ar: 'لفافات فوري' },
    { id: '3', name: 'Barcode Stickers', name_ar: 'ملصقات باركود' },
    { id: '4', name: 'Fridge Stickers', name_ar: 'ملصقات ثلاجة' },
  ],
  products: [
    { id: 'p1', name: 'Cashier Paper Roll (80mm)', name_ar: 'لفافة ورق كاشير (80 مم)', categoryId: '1', description: 'High-quality thermal paper for all standard cashier machines.', description_ar: 'ورق حراري عالي الجودة لجميع ماكينات الكاشير القياسية.', price: 12.50, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Paper+Roll', rating: 4.8, sales: 150 },
    { id: 'p2', name: 'Fawry Roll (57mm)', name_ar: 'لفافة فوري (57 مم)', categoryId: '2', description: 'Thermal rolls optimized for Fawry payment terminals.', description_ar: 'لفافات حرارية محسّنة لأجهزة الدفع فوري.', price: 9.75, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Fawry+Roll', rating: 4.5, sales: 90 },
    { id: 'p3', name: 'Barcode Stickers (1000 Pcs)', name_ar: 'ملصقات باركود (1000 قطعة)', categoryId: '3', description: 'Durable adhesive stickers for product labeling and inventory management.', description_ar: 'ملصقات لاصقة متينة لتسمية المنتجات وإدارة المخزون.', price: 25.00, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Barcode+Stickers', rating: 4.9, sales: 210 },
    { id: 'p4', name: 'Fridge Stickers (A5)', name_ar: 'ملصقات ثلاجة (A5)', categoryId: '4', description: 'Waterproof and durable stickers for cold storage and refrigerators.', description_ar: 'ملصقات مقاومة للماء ومتينة للتخزين البارد والثلاجات.', price: 18.25, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Fridge+Stickers', rating: 4.2, sales: 65 },
    { id: 'p5', name: 'Cashier Paper Roll (57mm)', name_ar: 'لفافة ورق كاشير (57 مم)', categoryId: '1', description: 'Standard size thermal paper rolls for smaller POS systems.', description_ar: 'لفافات ورق حراري بحجم قياسي لأنظمة نقاط البيع الأصغر.', price: 10.00, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Paper+Roll+57mm', rating: 4.6, sales: 110 },
    { id: 'p6', name: 'Barcode Stickers (2500 Pcs)', name_ar: 'ملصقات باركود (2500 قطعة)', categoryId: '3', description: 'Bulk pack of high-quality barcode stickers for industrial use.', description_ar: 'عبوة كبيرة من ملصقات الباركود عالية الجودة للاستخدام الصناعي.', price: 45.00, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Bulk+Barcodes', rating: 5.0, sales: 85 },
    { id: 'p7', name: 'Fawry Roll (80mm)', name_ar: 'لفافة فوري (80 مم)', categoryId: '2', description: 'Larger thermal rolls for Fawry terminals requiring wider receipts.', description_ar: 'لفافات حرارية أكبر لأجهزة فوري التي تتطلب إيصالات أوسع.', price: 11.50, imageUrl: 'https://placehold.co/600x400/1e293b/fff?text=Fawry+Roll+80mm', rating: 4.7, sales: 75 },
  ],
};

const Header = ({ onNavigate, cartCount, onSearch, onToggleMenu, isLoggedIn, categories, wishlistCount }) => {
  const [searchTerm, setSearchTerm] = useState('');

  const handleSearch = (e) => {
    e.preventDefault();
    onSearch(searchTerm);
  };

  return (
    <header className="fixed top-0 left-0 right-0 z-50 bg-white shadow-md rounded-b-xl">
      <div className="container mx-auto px-4 py-4 flex items-center justify-between gap-4">
        <div className="flex items-center gap-2">
          <button className="lg:hidden text-gray-700" onClick={onToggleMenu}>
            <Menu size={28} />
          </button>
          <a href="#" className="flex items-center gap-2" onClick={() => onNavigate('home')}>
            <h1 className="text-xl md:text-2xl font-bold text-slate-800">Hitech Factory</h1>
          </a>
        </div>
        <form onSubmit={handleSearch} className="flex-1 max-w-lg hidden lg:flex items-center border border-gray-300 rounded-full overflow-hidden focus-within:ring-2 focus-within:ring-slate-500 transition-all duration-300">
          <input
            type="text"
            placeholder="البحث عن المنتجات..."
            className="flex-1 py-2 px-4 focus:outline-none text-right"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
          <button type="submit" className="bg-slate-800 text-white p-3 rounded-full m-1">
            <Search size={20} />
          </button>
        </form>
        <div className="flex items-center gap-4">
          <button onClick={() => onNavigate('cart')} className="relative text-gray-700">
            <ShoppingCart size={28} />
            {cartCount > 0 && (
              <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
                {cartCount}
              </span>
            )}
          </button>
          <button onClick={() => onNavigate('wishlist')} className="relative text-gray-700">
            <Heart size={28} />
            {wishlistCount > 0 && (
              <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
                {wishlistCount}
              </span>
            )}
          </button>
          <button onClick={() => onNavigate(isLoggedIn ? 'dashboard' : 'login')} className="hidden sm:block text-gray-700">
            <User size={28} />
          </button>
        </div>
      </div>
      <form onSubmit={handleSearch} className="flex lg:hidden items-center p-4 border-t border-gray-200">
        <input
          type="text"
          placeholder="البحث عن المنتجات..."
          className="flex-1 py-2 px-4 border border-gray-300 rounded-l-full focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
        <button type="submit" className="bg-slate-800 text-white p-3 rounded-r-full">
          <Search size={20} />
        </button>
      </form>
    </header>
  );
};

const ProductCard = ({ product, onNavigate, onAddToCart, onAddToWishlist, isWishlisted }) => (
  <div className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 border border-gray-200 text-right">
    <div className="relative group overflow-hidden">
      <img
        src={product.imageUrl}
        alt={product.name}
        className="w-full h-48 object-cover rounded-t-xl transition-transform duration-300 group-hover:scale-105"
      />
      <div className="absolute top-2 right-2 p-2 bg-white bg-opacity-75 rounded-full">
        <button onClick={() => onAddToWishlist(product.id)} className={`transition-colors ${isWishlisted ? 'text-red-500' : 'text-gray-500 hover:text-red-500'}`}>
          <Heart size={24} fill={isWishlisted ? 'currentColor' : 'none'} />
        </button>
      </div>
    </div>
    <div className="p-4">
      <h3 className="text-lg font-semibold text-slate-800 truncate">{product.name_ar}</h3>
      <p className="text-slate-600 text-sm mt-1 mb-2">${product.price.toFixed(2)}</p>
      <div className="flex items-center text-yellow-400 text-sm mb-4 justify-end">
        <span className="ml-1 text-slate-500 text-xs">({product.rating.toFixed(1)})</span>
        {'☆'.repeat(5 - Math.floor(product.rating))}
        {'★'.repeat(Math.floor(product.rating))}
      </div>
      <div className="flex gap-2">
        <button
          onClick={() => onNavigate('product', { productId: product.id })}
          className="flex-1 bg-slate-100 text-slate-700 py-2 rounded-full font-medium transition-all duration-300 hover:bg-slate-200"
        >
          عرض التفاصيل
        </button>
        <button
          onClick={() => onAddToCart(product)}
          className="flex-1 bg-slate-800 text-white py-2 rounded-full font-medium transition-all duration-300 hover:bg-slate-700"
        >
          أضف إلى السلة
        </button>
      </div>
    </div>
  </div>
);

const ProductList = ({ products, onNavigate, onAddToCart, onAddToWishlist, categories, onFilter, selectedCategory, searchQuery, wishlist }) => (
  <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen">
    <div className="flex flex-col md:flex-row md:items-center justify-between mb-8">
      <h2 className="text-3xl md:text-4xl font-bold text-slate-800 mb-4 md:mb-0 text-right">
        {searchQuery ? `نتائج البحث عن "${searchQuery}"` : selectedCategory ? categories.find(c => c.id === selectedCategory)?.name_ar : 'كل المنتجات'}
      </h2>
      <div className="flex flex-wrap gap-2 justify-end">
        <button
          onClick={() => onFilter(null)}
          className={`py-2 px-4 rounded-full font-medium transition-colors ${!selectedCategory ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}
        >
          الكل
        </button>
        {categories.map(category => (
          <button
            key={category.id}
            onClick={() => onFilter(category.id)}
            className={`py-2 px-4 rounded-full font-medium transition-colors ${selectedCategory === category.id ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}
          >
            {category.name_ar}
          </button>
        ))}
      </div>
    </div>
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
      {products.length > 0 ? (
        products.map(product => (
          <ProductCard
            key={product.id}
            product={product}
            onNavigate={onNavigate}
            onAddToCart={onAddToCart}
            onAddToWishlist={onAddToWishlist}
            isWishlisted={wishlist.includes(product.id)}
          />
        ))
      ) : (
        <p className="col-span-full text-center text-lg text-slate-500 p-8">لم يتم العثور على منتجات لبحثك.</p>
      )}
    </div>
  </div>
);

const ProductDetail = ({ product, onNavigate, onAddToCart, onAddToWishlist, isWishlisted, onGetRecommendations, recommendedProducts, recommendationsLoading }) => {
  if (!product) {
    return (
      <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 text-right">
        <p className="text-center text-lg text-slate-500">المنتج غير موجود.</p>
        <button
          onClick={() => onNavigate('home')}
          className="mt-4 flex items-center gap-2 text-slate-700 hover:underline transition-colors"
        >
          <ChevronLeft size={20} /> العودة إلى المنتجات
        </button>
      </div>
    );
  }

  const handleReorder = () => {
      onAddToCart(product);
      alert(`تم إضافة ${product.name_ar} إلى سلة التسوق!`);
  };

  return (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
      <button
        onClick={() => onNavigate('home')}
        className="mb-6 flex items-center gap-2 text-slate-700 hover:underline transition-colors"
      >
        <ChevronLeft size={20} /> العودة إلى المنتجات
      </button>
      <div className="flex flex-col md:flex-row gap-8 lg:gap-16 bg-white rounded-3xl p-6 md:p-12 shadow-lg border border-gray-200">
        <div className="w-full md:w-1/2">
          <img
            src={product.imageUrl}
            alt={product.name_ar}
            className="w-full h-80 md:h-96 object-cover rounded-2xl shadow-md"
          />
        </div>
        <div className="w-full md:w-1/2 flex flex-col justify-center">
          <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-2">{product.name_ar}</h1>
          <p className="text-xl text-slate-600 mb-4">${product.price.toFixed(2)}</p>
          <div className="flex items-center text-yellow-400 text-lg mb-4 justify-end">
            <span className="ml-2 text-slate-500 text-sm">({product.rating.toFixed(1)} تقييم)</span>
            {'☆'.repeat(5 - Math.floor(product.rating))}
            {'★'.repeat(Math.floor(product.rating))}
          </div>
          <p className="text-slate-700 mb-8 leading-relaxed">{product.description_ar}</p>
          <div className="flex items-center gap-4">
            <button
              onClick={() => onAddToCart(product)}
              className="flex-1 bg-slate-800 text-white py-3 rounded-full font-semibold transition-all duration-300 hover:bg-slate-700"
            >
              أضف إلى السلة
            </button>
            <button
              onClick={() => onAddToWishlist(product.id)}
              className={`p-3 rounded-full transition-colors ${isWishlisted ? 'bg-red-500 text-white' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}
            >
              <Heart size={24} fill={isWishlisted ? 'currentColor' : 'none'} />
            </button>
          </div>
          <button
              onClick={handleReorder}
              className="mt-4 w-full bg-blue-600 text-white py-3 rounded-full font-semibold transition-all duration-300 hover:bg-blue-700"
          >
              إعادة طلب هذا المنتج
          </button>
          <div className="mt-8 border-t border-gray-200 pt-6">
            <h3 className="text-xl font-semibold mb-2 text-slate-800">تقييمات العملاء</h3>
            <p className="text-sm text-slate-500">
              (هذا القسم لأغراض العرض التوضيحي. التقييمات غير فعالة.)
            </p>
          </div>
        </div>
      </div>
      
      {/* AI-powered product recommendations section */}
      <div className="mt-12">
          <h2 className="text-3xl font-bold text-slate-800 mb-4 text-right">مقترحات لك ✨</h2>
          <div className="flex justify-end mb-4">
            <button
                onClick={() => onGetRecommendations(product.name)}
                className="bg-purple-600 text-white py-2 px-6 rounded-full font-semibold hover:bg-purple-700 transition-colors flex items-center gap-2"
                disabled={recommendationsLoading}
            >
                <Sparkles size={20} />
                <span>{recommendationsLoading ? 'جاري التحميل...' : 'احصل على مقترحات'}</span>
            </button>
          </div>
          {recommendedProducts.length > 0 && (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                  {recommendedProducts.map(recProduct => (
                      <ProductCard
                          key={recProduct.id}
                          product={recProduct}
                          onNavigate={onNavigate}
                          onAddToCart={onAddToCart}
                          onAddToWishlist={onAddToWishlist}
                      />
                  ))}
              </div>
          )}
      </div>
    </div>
  );
};

const Wishlist = ({ products, onNavigate, onAddToCart, onAddToWishlist, wishlist }) => {
    const wishlistedProducts = products.filter(p => wishlist.includes(p.id));
    
    return (
        <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">قائمة المفضلة</h1>
            {wishlistedProducts.length === 0 ? (
                <div className="text-center py-12">
                    <Heart size={80} className="mx-auto text-slate-400 mb-4" />
                    <p className="text-lg text-slate-600">قائمة المفضلة فارغة. ابدأ بإضافة المنتجات التي تعجبك!</p>
                    <button
                        onClick={() => onNavigate('home')}
                        className="mt-6 inline-flex items-center gap-2 bg-slate-800 text-white py-3 px-6 rounded-full font-semibold transition-colors hover:bg-slate-700"
                    >
                        ابدأ التسوق
                    </button>
                </div>
            ) : (
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    {wishlistedProducts.map(product => (
                        <ProductCard
                            key={product.id}
                            product={product}
                            onNavigate={onNavigate}
                            onAddToCart={onAddToCart}
                            onAddToWishlist={onAddToWishlist}
                            isWishlisted={true}
                        />
                    ))}
                </div>
            )}
        </div>
    );
};


const Cart = ({ cart, onNavigate, onUpdateQuantity, onRemoveItem, isLoggedIn, onCheckout, onProcessPayment }) => {
  const total = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
  const [paymentMethod, setPaymentMethod] = useState('');
  const [visaInfo, setVisaInfo] = useState({ number: '', expiry: '', cvv: '' });
  const [cashInfo, setCashInfo] = useState({ phone: '', screenshot: null });

  const handleCheckout = () => {
    if (!isLoggedIn) {
      alert('الرجاء تسجيل الدخول لإتمام الطلب.');
      onNavigate('login');
      return;
    }
    if (!paymentMethod) {
      alert('الرجاء اختيار طريقة دفع.');
      return;
    }

    if (paymentMethod === 'بطاقة Visa / Mastercard') {
        if (!visaInfo.number || !visaInfo.expiry || !visaInfo.cvv) {
            alert('الرجاء إدخال جميع معلومات البطاقة.');
            return;
        }
    } else if (paymentMethod === 'InstaPay' || paymentMethod === 'Vodafone Cash') {
        if (!cashInfo.phone || !cashInfo.screenshot) {
            alert('الرجاء إدخال رقم هاتفك وإرفاق لقطة شاشة للتحويل.');
            return;
        }
    }
    
    if (paymentMethod === 'InstaPay' || paymentMethod === 'Vodafone Cash') {
        onProcessPayment({
            id: Date.now(),
            total,
            method: paymentMethod,
            phone: cashInfo.phone,
            screenshot: cashInfo.screenshot ? URL.createObjectURL(cashInfo.screenshot) : null,
        });
        alert('تم إرسال طلب الدفع الخاص بك للمراجعة. سيتم شحن طلبك بعد التأكد من التحويل.');
        onCheckout();
    } else {
        alert(`تم إتمام طلبك بنجاح باستخدام ${paymentMethod}!`);
        onCheckout();
    }
  };

  const paymentMethods = [
    { id: 'visa', name: 'بطاقة Visa / Mastercard' },
    { id: 'instapay', name: 'InstaPay' },
    { id: 'vodafonecash', name: 'Vodafone Cash' },
  ];

  return (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
      <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">سلة التسوق</h1>
      {cart.length === 0 ? (
        <div className="text-center py-12">
          <ShoppingCart size={80} className="mx-auto text-slate-400 mb-4" />
          <p className="text-lg text-slate-600">سلتك فارغة.</p>
          <button
            onClick={() => onNavigate('home')}
            className="mt-6 inline-flex items-center gap-2 bg-slate-800 text-white py-3 px-6 rounded-full font-semibold transition-colors hover:bg-slate-700"
          >
            ابدأ التسوق
          </button>
        </div>
      ) : (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div className="lg:col-span-2 space-y-4">
            {cart.map(item => (
              <div key={item.id} className="bg-white p-4 md:p-6 rounded-2xl shadow-sm border border-gray-200 flex items-center gap-4 flex-row-reverse">
                <img
                  src={item.imageUrl}
                  alt={item.name_ar}
                  className="w-24 h-24 object-cover rounded-xl"
                />
                <div className="flex-1 text-right">
                  <h2 className="text-lg md:text-xl font-semibold text-slate-800">{item.name_ar}</h2>
                  <p className="text-slate-600">${(item.price * item.quantity).toFixed(2)}</p>
                </div>
                <div className="flex items-center gap-2 flex-row-reverse">
                  <button
                    onClick={() => onUpdateQuantity(item.id, item.quantity - 1)}
                    disabled={item.quantity <= 1}
                    className="p-2 bg-slate-100 rounded-full text-slate-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    <Minus size={16} />
                  </button>
                  <span className="text-lg font-medium w-6 text-center">{item.quantity}</span>
                  <button
                    onClick={() => onUpdateQuantity(item.id, item.quantity + 1)}
                    className="p-2 bg-slate-100 rounded-full text-slate-700"
                  >
                    <Plus size={16} />
                  </button>
                </div>
                <button
                  onClick={() => onRemoveItem(item.id)}
                  className="p-2 text-red-500 hover:text-red-700 transition-colors"
                >
                  <Trash2 size={24} />
                </button>
              </div>
            ))}
          </div>
          <div className="lg:col-span-1 bg-white p-6 rounded-2xl shadow-lg border border-gray-200 h-fit">
            <h2 className="text-2xl font-bold text-slate-800 mb-4 text-right">ملخص الطلب</h2>
            <div className="flex justify-between text-slate-600 mb-2">
              <span>المجموع الفرعي</span>
              <span>${total.toFixed(2)}</span>
            </div>
            <div className="flex justify-between text-slate-600 mb-4">
              <span>الشحن</span>
              <span>مجاني</span>
            </div>
            <div className="flex justify-between font-bold text-xl text-slate-800 border-t border-gray-200 pt-4">
              <span>الإجمالي</span>
              <span>${total.toFixed(2)}</span>
            </div>
            
            <div className="mt-6">
                <h3 className="text-lg font-semibold mb-2 text-slate-700">طريقة الدفع</h3>
                {paymentMethods.map(method => (
                    <div key={method.id} className="mb-2">
                        <label className="flex items-center gap-2 cursor-pointer">
                            <input
                                type="radio"
                                name="paymentMethod"
                                value={method.name}
                                checked={paymentMethod === method.name}
                                onChange={() => setPaymentMethod(method.name)}
                                className="form-radio text-slate-800 h-4 w-4"
                            />
                            <span className="text-slate-700">{method.name}</span>
                        </label>
                    </div>
                ))}
            </div>

            {paymentMethod === 'بطاقة Visa / Mastercard' && (
                <div className="mt-6 space-y-4">
                    <h4 className="text-lg font-semibold text-slate-700">معلومات البطاقة</h4>
                    <div>
                        <label className="block text-slate-600 mb-1">رقم البطاقة</label>
                        <input
                            type="text"
                            value={visaInfo.number}
                            onChange={(e) => setVisaInfo({ ...visaInfo, number: e.target.value })}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                            placeholder="xxxx xxxx xxxx xxxx"
                        />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-slate-600 mb-1">تاريخ الانتهاء</label>
                            <input
                                type="text"
                                value={visaInfo.expiry}
                                onChange={(e) => setVisaInfo({ ...visaInfo, expiry: e.target.value })}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                                placeholder="MM/YY"
                            />
                        </div>
                        <div>
                            <label className="block text-slate-600 mb-1">رمز الأمان (CVV)</label>
                            <input
                                type="text"
                                value={visaInfo.cvv}
                                onChange={(e) => setVisaInfo({ ...visaInfo, cvv: e.target.value })}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                                placeholder="CVV"
                            />
                        </div>
                    </div>
                </div>
            )}

            {(paymentMethod === 'InstaPay' || paymentMethod === 'Vodafone Cash') && (
                <div className="mt-6 space-y-4">
                    <h4 className="text-lg font-semibold text-slate-700">معلومات التحويل</h4>
                    <p className="text-sm text-slate-600">
                        الرجاء التحويل إلى رقم الهاتف: <span className="font-bold text-slate-800">01025380065</span>
                    </p>
                    <div>
                        <label className="block text-slate-600 mb-1">رقم هاتفك</label>
                        <input
                            type="tel"
                            value={cashInfo.phone}
                            onChange={(e) => setCashInfo({ ...cashInfo, phone: e.target.value })}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                            placeholder="رقم الهاتف"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-600 mb-1">لقطة شاشة للتحويل</label>
                        <input
                            type="file"
                            onChange={(e) => setCashInfo({ ...cashInfo, screenshot: e.target.files[0] })}
                            className="w-full text-slate-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-slate-800 file:text-white hover:file:bg-slate-700 cursor-pointer"
                        />
                        {cashInfo.screenshot && (
                            <p className="text-sm text-green-600 mt-2">تم رفع الملف: {cashInfo.screenshot.name}</p>
                        )}
                    </div>
                </div>
            )}

            <button
                onClick={handleCheckout}
                className="mt-6 w-full bg-slate-800 text-white py-3 rounded-full font-semibold transition-colors hover:bg-slate-700"
            >
              متابعة الدفع
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

const Login = ({ onLogin, onNavigate }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleLogin = (e) => {
    e.preventDefault();
    if (email === 'vcfcdef780@gmail.com' && password === 'admin123') {
      onLogin(true);
      onNavigate('dashboard');
    } else {
      alert('بيانات الاعتماد غير صالحة.');
    }
  };

  return (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen flex items-center justify-center">
      <div className="w-full max-w-md p-8 bg-white rounded-3xl shadow-lg border border-gray-200">
        <h1 className="text-3xl font-bold text-slate-800 mb-6 text-center">تسجيل الدخول</h1>
        <form onSubmit={handleLogin} className="space-y-4 text-right">
          <div>
            <label className="block text-slate-700 font-medium mb-1">البريد الإلكتروني</label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
              required
            />
          </div>
          <div>
            <label className="block text-slate-700 font-medium mb-1">كلمة المرور</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
              required
            />
          </div>
          <button
            type="submit"
            className="w-full bg-slate-800 text-white py-3 rounded-lg font-semibold hover:bg-slate-700 transition-colors"
          >
            تسجيل الدخول
          </button>
        </form>
        <p className="mt-4 text-center text-sm text-slate-500">
          <button onClick={() => onNavigate('register')} className="text-slate-800 hover:underline font-semibold">
            هل أنت مستخدم جديد؟
          </button>
        </p>
        <p className="mt-2 text-center text-sm text-slate-500">
          <button onClick={() => onNavigate('forgotPassword')} className="text-slate-800 hover:underline font-semibold">
            نسيت كلمة المرور؟
          </button>
        </p>
      </div>
    </div>
  );
};

const ForgotPassword = ({ onNavigate }) => {
  const [step, setStep] = useState('email'); // 'email', 'verify', 'reset'
  const [email, setEmail] = useState('');
  const [code, setCode] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');

  const handleSendCode = (e) => {
    e.preventDefault();
    if (email) {
      alert(`تم إرسال رمز التحقق إلى بريدك الإلكتروني: ${email}. الرمز هو: 123456`);
      setStep('verify');
    }
  };

  const handleResetPassword = (e) => {
    e.preventDefault();
    if (code === '123456' && newPassword === confirmPassword) {
      alert('تم تغيير كلمة المرور بنجاح!');
      onNavigate('login');
    } else {
      alert('الرمز أو كلمة المرور غير صحيحة. يرجى المحاولة مرة أخرى.');
    }
  };

  return (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen flex items-center justify-center">
      <div className="w-full max-w-md p-8 bg-white rounded-3xl shadow-lg border border-gray-200">
        <h1 className="text-3xl font-bold text-slate-800 mb-6 text-center">إعادة تعيين كلمة المرور</h1>
        
        {step === 'email' && (
          <form onSubmit={handleSendCode} className="space-y-4 text-right">
            <p className="text-slate-600 text-center">أدخل بريدك الإلكتروني لإرسال رمز التحقق.</p>
            <div>
              <label className="block text-slate-700 font-medium mb-1">البريد الإلكتروني</label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                required
              />
            </div>
            <button type="submit" className="w-full bg-slate-800 text-white py-3 rounded-lg font-semibold hover:bg-slate-700 transition-colors">
              إرسال الرمز
            </button>
            <p className="mt-4 text-center text-sm text-slate-500">
              <button onClick={() => onNavigate('login')} className="text-slate-800 hover:underline font-semibold">
                العودة إلى تسجيل الدخول
              </button>
            </p>
          </form>
        )}

        {step === 'verify' && (
          <form onSubmit={handleResetPassword} className="space-y-4 text-right">
            <p className="text-slate-600 text-center">تم إرسال الرمز إلى بريدك الإلكتروني.</p>
            <div>
              <label className="block text-slate-700 font-medium mb-1">رمز التحقق</label>
              <input
                type="text"
                value={code}
                onChange={(e) => setCode(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                required
              />
            </div>
            <div>
              <label className="block text-slate-700 font-medium mb-1">كلمة المرور الجديدة</label>
              <input
                type="password"
                value={newPassword}
                onChange={(e) => setNewPassword(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                required
              />
            </div>
            <div>
              <label className="block text-slate-700 font-medium mb-1">تأكيد كلمة المرور</label>
              <input
                type="password"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                required
              />
            </div>
            <button type="submit" className="w-full bg-slate-800 text-white py-3 rounded-lg font-semibold hover:bg-slate-700 transition-colors">
              إعادة تعيين كلمة المرور
            </button>
          </form>
        )}
      </div>
    </div>
  );
};


const Register = ({ onNavigate }) => {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    phone: '',
    password: '',
    confirmPassword: '',
    countryCode: '+20',
    address: '',
    city: '',
    country: '',
  });
  const [otpSent, setOtpSent] = useState(false);
  const [otp, setOtp] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSendOtp = (e) => {
    e.preventDefault();
    if (formData.password !== formData.confirmPassword) {
      alert('كلمة المرور وتأكيدها غير متطابقين. يرجى المحاولة مرة أخرى.');
      return;
    }
    setOtpSent(true);
    alert('تم إرسال كود التحقق إلى بريدك الإلكتروني. الكود هو: 123456');
  };

  const handleVerify = (e) => {
    e.preventDefault();
    if (otp === '123456') { // Mock OTP verification
        alert('تم التحقق من البريد الإلكتروني بنجاح! سيتم حفظ بياناتك.');
        onNavigate('login');
    } else {
        alert('كود التحقق غير صحيح. يرجى المحاولة مرة أخرى.');
    }
  };

  return (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen flex items-center justify-center">
      <div className="w-full max-w-lg p-8 bg-white rounded-3xl shadow-lg border border-gray-200">
        <h1 className="text-3xl font-bold text-slate-800 mb-6 text-center">تسجيل مستخدم جديد</h1>
        <form onSubmit={e => e.preventDefault()} className="space-y-4 text-right">
          
          {!otpSent ? (
            <>
                <div>
                  <label className="block text-slate-700 font-medium mb-1">الاسم الكامل</label>
                  <input
                    type="text"
                    name="name"
                    value={formData.name}
                    onChange={handleChange}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                    required
                  />
                </div>
                <div>
                  <label className="block text-slate-700 font-medium mb-1">البريد الإلكتروني</label>
                  <input
                    type="email"
                    name="email"
                    value={formData.email}
                    onChange={handleChange}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                    required
                  />
                </div>
                <div className="flex items-center gap-2 flex-row-reverse">
                  <div className="flex-1">
                    <label className="block text-slate-700 font-medium mb-1">رقم الهاتف</label>
                    <input
                      type="tel"
                      name="phone"
                      value={formData.phone}
                      onChange={handleChange}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                      required
                    />
                  </div>
                  <div>
                    <label className="block text-slate-700 font-medium mb-1">كود الدولة</label>
                    <input
                      type="text"
                      value="+20"
                      className="w-20 p-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed text-center"
                      disabled
                    />
                  </div>
                </div>
                <div>
                  <label className="block text-slate-700 font-medium mb-1">كلمة المرور</label>
                  <input
                    type="password"
                    name="password"
                    value={formData.password}
                    onChange={handleChange}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                    required
                  />
                </div>
                <div>
                  <label className="block text-slate-700 font-medium mb-1">إعادة إدخال كلمة المرور</label>
                  <input
                    type="password"
                    name="confirmPassword"
                    value={formData.confirmPassword}
                    onChange={handleChange}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                    required
                  />
                </div>
                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-slate-700 font-medium mb-1">البلد</label>
                      <input
                        type="text"
                        name="country"
                        value={formData.country}
                        onChange={handleChange}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        required
                      />
                    </div>
                    <div>
                      <label className="block text-slate-700 font-medium mb-1">المدينة</label>
                      <input
                        type="text"
                        name="city"
                        value={formData.city}
                        onChange={handleChange}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        required
                      />
                    </div>
                  </div>
                <div>
                  <label className="block text-slate-700 font-medium mb-1">العنوان بالتفصيل</label>
                  <input
                    type="text"
                    name="address"
                    value={formData.address}
                    onChange={handleChange}
                    className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                    required
                  />
                </div>
                <button
                  type="button"
                  onClick={handleSendOtp}
                  className="w-full bg-slate-800 text-white py-3 rounded-lg font-semibold hover:bg-slate-700 transition-colors"
                >
                  إرسال الرمز
                </button>
            </>
          ) : (
            <div>
              <label className="block text-slate-700 font-medium mb-1">أدخل رمز التحقق</label>
              <div className="flex items-center gap-2 flex-row-reverse">
                <input
                  type="text"
                  value={otp}
                  onChange={(e) => setOtp(e.target.value)}
                  className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                  required
                />
                <button
                  type="button"
                  onClick={handleVerify}
                  className="bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                >
                  تحقق
                </button>
              </div>
            </div>
          )}
          
          <p className="mt-4 text-center text-sm text-slate-500">
            <button onClick={() => onNavigate('login')} className="text-slate-800 hover:underline font-semibold">
              هل لديك حساب بالفعل؟
            </button>
          </p>
        </form>
      </div>
    </div>
  );
};


const SalesDashboard = ({ onLogout, onNavigate, products, pendingPayments, onApprovePayment }) => {
  const kpis = [
    { title: "إجمالي الإيرادات", value: "$34,567", trend: "+5.2% منذ الأسبوع الماضي" },
    { title: "عدد الطلبات", value: "1,245", trend: "+12.1% منذ الأسبوع الماضي" },
    { title: "العملاء النشطين", value: "852", trend: "-1.8% منذ الأسبوع الماضي" },
  ];

  const recentSales = [
    { id: "S101", date: "22/09/2024", product: "Barcode Stickers", amount: "$250.00", status: "تم التسليم" },
    { id: "S102", date: "21/09/2024", product: "Cashier Paper Roll", amount: "$125.50", status: "تم الشحن" },
    { id: "S103", date: "20/09/2024", product: "Fawry Roll", amount: "$97.50", status: "قيد المعالجة" },
    { id: "S104", date: "19/09/2024", product: "Fridge Stickers", amount: "$182.50", status: "تم التسليم" },
  ];

  // Logic to get top 5 selling products for the chart
  const topProducts = [...products].sort((a, b) => b.sales - a.sales).slice(0, 5);

  return (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl md:text-4xl font-bold text-slate-800">لوحة تحكم المبيعات</h1>
        <button onClick={onLogout} className="flex items-center gap-2 bg-red-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-red-600 transition-colors">
          <LogOut size={20} />
          <span>تسجيل الخروج</span>
        </button>
      </div>

      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        {kpis.map((kpi, index) => (
          <div key={index} className="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
            <h3 className="text-lg font-semibold text-slate-600 mb-1">{kpi.title}</h3>
            <p className="text-3xl font-bold text-slate-800">{kpi.value}</p>
            <p className="text-sm text-green-500 mt-1">{kpi.trend}</p>
          </div>
        ))}
      </div>
        
      {/* Product Sales Chart */}
      <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 mb-8">
        <h2 className="text-2xl font-bold text-slate-800 mb-4">أعلى المنتجات مبيعًا</h2>
        <div className="w-full h-64 flex items-end gap-2 p-4">
          {topProducts.map((product, index) => (
            <div key={product.id} className="relative flex flex-col items-center justify-end w-1/5 h-full">
              <div
                className="bg-slate-800 rounded-t-lg transition-all duration-500 ease-out hover:bg-slate-600"
                style={{ height: `${(product.sales / topProducts[0].sales) * 90}%`, width: '80%' }}
              ></div>
              <span className="text-xs text-slate-500 mt-2 rotate-[-45deg] whitespace-nowrap overflow-hidden text-ellipsis w-full text-center">
                {product.name_ar}
              </span>
              <span className="absolute top-0 text-sm font-semibold text-slate-800 translate-y-[-120%]">
                {product.sales}
              </span>
            </div>
          ))}
        </div>
      </div>
      
      <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 overflow-x-auto">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-bold text-slate-800">المبيعات الأخيرة</h2>
          <div className="flex gap-4">
            <button onClick={() => onNavigate('productManagement')} className="flex items-center gap-2 bg-slate-800 text-white py-2 px-4 rounded-full font-semibold hover:bg-slate-700 transition-colors">
              <Package size={20} />
              <span>إدارة المنتجات</span>
            </button>
            <button onClick={() => onNavigate('categoryManagement')} className="flex items-center gap-2 bg-slate-800 text-white py-2 px-4 rounded-full font-semibold hover:bg-slate-700 transition-colors">
              <Edit size={20} />
              <span>إدارة الفئات</span>
            </button>
          </div>
        </div>
        <table className="min-w-full text-right table-auto">
          <thead>
            <tr className="bg-slate-100 text-slate-600 text-sm font-semibold uppercase tracking-wider rounded-lg">
              <th className="py-3 px-4 rounded-l-lg">رقم الطلب</th>
              <th className="py-3 px-4">التاريخ</th>
              <th className="py-3 px-4">المنتج</th>
              <th className="py-3 px-4">المبلغ</th>
              <th className="py-3 px-4 rounded-r-lg">الحالة</th>
            </tr>
          </thead>
          <tbody>
            {recentSales.map((sale) => (
              <tr key={sale.id} className="border-b border-gray-200 last:border-b-0 text-slate-700">
                <td className="py-3 px-4 font-medium">{sale.id}</td>
                <td className="py-3 px-4">{sale.date}</td>
                <td className="py-3 px-4">{sale.product}</td>
                <td className="py-3 px-4 font-medium">{sale.amount}</td>
                <td className="py-3 px-4">
                  <span className={`py-1 px-3 rounded-full text-xs font-semibold ${
                    sale.status === 'تم التسليم' ? 'bg-green-100 text-green-700' :
                    sale.status === 'تم الشحن' ? 'bg-blue-100 text-blue-700' :
                    'bg-yellow-100 text-yellow-700'
                  }`}>
                    {sale.status}
                  </span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 mt-8">
        <h2 className="text-2xl font-bold text-slate-800 mb-4">الدفعات المعلقة (InstaPay / Vodafone Cash)</h2>
        {pendingPayments.length > 0 ? (
          <div className="overflow-x-auto">
            <table className="min-w-full text-right table-auto">
                <thead>
                    <tr className="bg-red-100 text-red-600 text-sm font-semibold uppercase tracking-wider rounded-lg">
                        <th className="py-3 px-4 rounded-l-lg">رقم الطلب</th>
                        <th className="py-3 px-4">طريقة الدفع</th>
                        <th className="py-3 px-4">المبلغ</th>
                        <th className="py-3 px-4">رقم الهاتف</th>
                        <th className="py-3 px-4">لقطة الشاشة</th>
                        <th className="py-3 px-4 rounded-r-lg">الإجراء</th>
                    </tr>
                </thead>
                <tbody>
                    {pendingPayments.map(payment => (
                        <tr key={payment.id} className="border-b border-gray-200 last:border-b-0 text-slate-700">
                            <td className="py-3 px-4 font-medium">{payment.id}</td>
                            <td className="py-3 px-4">{payment.method}</td>
                            <td className="py-3 px-4">${payment.total.toFixed(2)}</td>
                            <td className="py-3 px-4">{payment.phone}</td>
                            <td className="py-3 px-4">
                                <a href={payment.screenshot} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                                    عرض لقطة الشاشة
                                </a>
                            </td>
                            <td className="py-3 px-4">
                                <button onClick={() => onApprovePayment(payment.id)} className="flex items-center gap-1 bg-green-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-green-600 transition-colors">
                                    <CheckCircle size={16} />
                                    <span>تأكيد الشحن</span>
                                </button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
          </div>
        ) : (
          <div className="text-center text-slate-500">
            <p>لا توجد دفعات معلقة حاليًا.</p>
          </div>
        )}
      </div>
    </div>
  );
};

const ProductManagement = ({ products, onNavigate, onEditProduct, onDeleteProduct, onAddProduct }) => (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
        <div className="flex justify-between items-center mb-6">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800">إدارة المنتجات</h1>
            <button onClick={() => onNavigate('addProduct')} className="flex items-center gap-2 bg-green-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-green-600 transition-colors">
                <Plus size={20} />
                <span>إضافة منتج جديد</span>
            </button>
        </div>
        <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 overflow-x-auto">
            <table className="min-w-full text-right table-auto">
                <thead>
                    <tr className="bg-slate-100 text-slate-600 text-sm font-semibold uppercase tracking-wider rounded-lg">
                        <th className="py-3 px-4 rounded-l-lg">الاسم (عربي)</th>
                        <th className="py-3 px-4">السعر</th>
                        <th className="py-3 px-4">التقييم</th>
                        <th className="py-3 px-4 rounded-r-lg">الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {products.map(product => (
                        <tr key={product.id} className="border-b border-gray-200 last:border-b-0 text-slate-700">
                            <td className="py-3 px-4 font-medium">{product.name_ar}</td>
                            <td className="py-3 px-4">${product.price.toFixed(2)}</td>
                            <td className="py-3 px-4">{product.rating.toFixed(1)}</td>
                            <td className="py-3 px-4 flex items-center gap-2">
                                <button onClick={() => onEditProduct(product.id)} className="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-colors">
                                    <Edit size={16} />
                                    <span>تعديل</span>
                                </button>
                                <button onClick={() => onDeleteProduct(product.id)} className="flex items-center gap-1 text-red-600 hover:text-red-800 transition-colors">
                                    <Trash2 size={16} />
                                    <span>حذف</span>
                                </button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    </div>
);

const AddProduct = ({ onNavigate, onSave, categories, onGenerateDescription }) => {
    const [formData, setFormData] = useState({
        id: `p${Date.now()}`,
        name: '',
        name_ar: '',
        categoryId: '',
        description: '',
        description_ar: '',
        price: '',
        imageUrl: '',
        rating: 5.0,
        sales: 0,
    });
    const [previewUrl, setPreviewUrl] = useState('');
    const [generating, setGenerating] = useState(false);

    const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            const url = URL.createObjectURL(file);
            setPreviewUrl(url);
            setFormData(prev => ({ ...prev, imageUrl: url }));
        }
    };

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSave = () => {
        onSave(formData);
        onNavigate('productManagement');
    };

    const handleGenerate = async () => {
        setGenerating(true);
        const newDescription = await onGenerateDescription(formData.name_ar, formData.categoryId);
        setFormData(prev => ({ ...prev, description_ar: newDescription }));
        setGenerating(false);
    };

    return (
        <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">إضافة منتج جديد</h1>
            <div className="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (إنجليزي)</label>
                        <input
                            type="text"
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (عربي)</label>
                        <input
                            type="text"
                            name="name_ar"
                            value={formData.name_ar}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الفئة</label>
                        <select
                            name="categoryId"
                            value={formData.categoryId}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        >
                            <option value="">اختر فئة</option>
                            {categories.map(cat => (
                                <option key={cat.id} value={cat.id}>{cat.name_ar}</option>
                            ))}
                        </select>
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">السعر ($)</label>
                        <input
                            type="number"
                            name="price"
                            value={formData.price}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                        />
                    </div>
                    <div className="col-span-1 md:col-span-2">
                        <div className="flex justify-between items-center mb-1">
                          <label className="block text-slate-700 font-medium">الوصف (عربي)</label>
                          <button
                            type="button"
                            onClick={handleGenerate}
                            className="flex items-center gap-1 text-purple-600 hover:text-purple-800 transition-colors"
                            disabled={generating}
                          >
                            <Sparkles size={16} />
                            <span>{generating ? 'جاري الإنشاء...' : 'إنشاء تلقائي'}</span>
                          </button>
                        </div>
                        <textarea
                            name="description_ar"
                            value={formData.description_ar}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                            rows="4"
                        ></textarea>
                    </div>
                     <div className="col-span-1 md:col-span-2">
                        <label className="block text-slate-700 font-medium mb-1">الوصف (إنجليزي)</label>
                        <textarea
                            name="description"
                            value={formData.description}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                            rows="4"
                        ></textarea>
                    </div>
                    <div className="col-span-1 md:col-span-2">
                        <label className="block text-slate-700 font-medium mb-1">صورة المنتج</label>
                        <input
                            type="file"
                            onChange={handleImageUpload}
                            className="w-full text-slate-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-slate-800 file:text-white hover:file:bg-slate-700 cursor-pointer"
                        />
                        {previewUrl && (
                            <div className="mt-4">
                                <p className="text-sm text-slate-500 mb-2">معاينة الصورة:</p>
                                <img src={previewUrl} alt="Product Preview" className="w-48 h-auto rounded-lg shadow-md border" />
                            </div>
                        )}
                    </div>
                </div>
                <div className="flex justify-end gap-4 mt-8">
                    <button onClick={() => onNavigate('productManagement')} className="bg-slate-100 text-slate-700 py-3 px-6 rounded-full font-semibold hover:bg-slate-200 transition-colors">
                        إلغاء
                    </button>
                    <button onClick={handleSave} className="bg-slate-800 text-white py-3 px-6 rounded-full font-semibold hover:bg-slate-700 transition-colors flex items-center gap-2">
                        <Save size={20} />
                        <span>حفظ المنتج</span>
                    </button>
                </div>
            </div>
        </div>
    );
};

const EditProduct = ({ product, onNavigate, onSave, onGenerateDescription }) => {
    const [formData, setFormData] = useState(product);
    const [previewUrl, setPreviewUrl] = useState(product.imageUrl);
    const [generating, setGenerating] = useState(false);

    // This function handles file selection and creates a temporary URL for preview
    const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            // Create a local URL for the image to display a preview
            const url = URL.createObjectURL(file);
            setPreviewUrl(url);
            // In a real app, you would upload this file to a server. Here we just update the form data with the local URL.
            setFormData(prev => ({ ...prev, imageUrl: url }));
        }
    };

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSave = () => {
        onSave(formData);
        onNavigate('productManagement');
    };

    const handleGenerate = async () => {
        setGenerating(true);
        const newDescription = await onGenerateDescription(formData.name_ar, formData.categoryId);
        setFormData(prev => ({ ...prev, description_ar: newDescription }));
        setGenerating(false);
    };

    return (
        <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">تعديل المنتج</h1>
            <div className="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (إنجليزي)</label>
                        <input
                            type="text"
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (عربي)</label>
                        <input
                            type="text"
                            name="name_ar"
                            value={formData.name_ar}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        />
                    </div>
                    <div className="col-span-1 md:col-span-2">
                        <div className="flex justify-between items-center mb-1">
                          <label className="block text-slate-700 font-medium">الوصف (عربي)</label>
                          <button
                            type="button"
                            onClick={handleGenerate}
                            className="flex items-center gap-1 text-purple-600 hover:text-purple-800 transition-colors"
                            disabled={generating}
                          >
                            <Sparkles size={16} />
                            <span>{generating ? 'جاري الإنشاء...' : 'إنشاء تلقائي'}</span>
                          </button>
                        </div>
                        <textarea
                            name="description_ar"
                            value={formData.description_ar}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                            rows="4"
                        ></textarea>
                    </div>
                     <div className="col-span-1 md:col-span-2">
                        <label className="block text-slate-700 font-medium mb-1">الوصف (إنجليزي)</label>
                        <textarea
                            name="description"
                            value={formData.description}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                            rows="4"
                        ></textarea>
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">السعر ($)</label>
                        <input
                            type="number"
                            name="price"
                            value={formData.price}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">صورة المنتج</label>
                        <input
                            type="file"
                            onChange={handleImageUpload}
                            className="w-full text-slate-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-slate-800 file:text-white hover:file:bg-slate-700 cursor-pointer"
                        />
                        {previewUrl && (
                            <div className="mt-4">
                                <p className="text-sm text-slate-500 mb-2">معاينة الصورة:</p>
                                <img src={previewUrl} alt="Product Preview" className="w-48 h-auto rounded-lg shadow-md border" />
                            </div>
                        )}
                    </div>
                </div>
                <div className="flex justify-end gap-4 mt-8">
                    <button onClick={() => onNavigate('productManagement')} className="bg-slate-100 text-slate-700 py-3 px-6 rounded-full font-semibold hover:bg-slate-200 transition-colors">
                        إلغاء
                    </button>
                    <button onClick={handleSave} className="bg-slate-800 text-white py-3 px-6 rounded-full font-semibold hover:bg-slate-700 transition-colors flex items-center gap-2">
                        <Save size={20} />
                        <span>حفظ التعديلات</span>
                    </button>
                </div>
            </div>
        </div>
    );
};

const CategoryManagement = ({ categories, onNavigate, onEditCategory, onDeleteCategory, onAddCategory }) => (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
        <div className="flex justify-between items-center mb-6">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800">إدارة الفئات</h1>
            <button onClick={() => onNavigate('addCategory')} className="flex items-center gap-2 bg-green-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-green-600 transition-colors">
                <Plus size={20} />
                <span>إضافة فئة جديدة</span>
            </button>
        </div>
        <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 overflow-x-auto">
            <table className="min-w-full text-right table-auto">
                <thead>
                    <tr className="bg-slate-100 text-slate-600 text-sm font-semibold uppercase tracking-wider rounded-lg">
                        <th className="py-3 px-4 rounded-l-lg">الاسم (عربي)</th>
                        <th className="py-3 px-4">الاسم (إنجليزي)</th>
                        <th className="py-3 px-4 rounded-r-lg">الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {categories.map(category => (
                        <tr key={category.id} className="border-b border-gray-200 last:border-b-0 text-slate-700">
                            <td className="py-3 px-4 font-medium">{category.name_ar}</td>
                            <td className="py-3 px-4">{category.name}</td>
                            <td className="py-3 px-4 flex items-center gap-2">
                                <button onClick={() => onEditCategory(category.id)} className="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-colors">
                                    <Edit size={16} />
                                    <span>تعديل</span>
                                </button>
                                <button onClick={() => onDeleteCategory(category.id)} className="flex items-center gap-1 text-red-600 hover:text-red-800 transition-colors">
                                    <Trash2 size={16} />
                                    <span>حذف</span>
                                </button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    </div>
);

const AddCategory = ({ onNavigate, onSave }) => {
    const [formData, setFormData] = useState({
        id: `c${Date.now()}`,
        name: '',
        name_ar: '',
    });

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSave = () => {
        if (!formData.name || !formData.name_ar) {
            alert('الرجاء إدخال الاسم باللغتين.');
            return;
        }
        onSave(formData);
        onNavigate('categoryManagement');
    };

    return (
        <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">إضافة فئة جديدة</h1>
            <div className="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (إنجليزي)</label>
                        <input
                            type="text"
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (عربي)</label>
                        <input
                            type="text"
                            name="name_ar"
                            value={formData.name_ar}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        />
                    </div>
                </div>
                <div className="flex justify-end gap-4 mt-8">
                    <button onClick={() => onNavigate('categoryManagement')} className="bg-slate-100 text-slate-700 py-3 px-6 rounded-full font-semibold hover:bg-slate-200 transition-colors">
                        إلغاء
                    </button>
                    <button onClick={handleSave} className="bg-slate-800 text-white py-3 px-6 rounded-full font-semibold hover:bg-slate-700 transition-colors flex items-center gap-2">
                        <Save size={20} />
                        <span>حفظ الفئة</span>
                    </button>
                </div>
            </div>
        </div>
    );
};


const EditCategory = ({ category, onNavigate, onSave }) => {
    const [formData, setFormData] = useState(category);

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSave = () => {
        onSave(formData);
        onNavigate('categoryManagement');
    };

    return (
        <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
            <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">تعديل الفئة</h1>
            <div className="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (إنجليزي)</label>
                        <input
                            type="text"
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"
                        />
                    </div>
                    <div>
                        <label className="block text-slate-700 font-medium mb-1">الاسم (عربي)</label>
                        <input
                            type="text"
                            name="name_ar"
                            value={formData.name_ar}
                            onChange={handleChange}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500 text-right"
                        />
                    </div>
                </div>
                <div className="flex justify-end gap-4 mt-8">
                    <button onClick={() => onNavigate('categoryManagement')} className="bg-slate-100 text-slate-700 py-3 px-6 rounded-full font-semibold hover:bg-slate-200 transition-colors">
                        إلغاء
                    </button>
                    <button onClick={handleSave} className="bg-slate-800 text-white py-3 px-6 rounded-full font-semibold hover:bg-slate-700 transition-colors flex items-center gap-2">
                        <Save size={20} />
                        <span>حفظ التعديلات</span>
                    </button>
                </div>
            </div>
        </div>
    );
};

const AboutUs = ({ onNavigate }) => (
    <div className="container mx-auto p-4 md:p-8 pt-24 md:pt-32 min-h-screen text-right">
        <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-6">عن المصنع</h1>
        <div className="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
            <div className="space-y-6">
                <p className="text-lg text-slate-700 leading-relaxed">
                    مصنع هاي تك متخصص في صناعة ورق الكاشير والفوري واستيكرات الباركود بأفضل سعر وأعلى الخامات، خبرة أكثر من 12 عام.
                </p>
                
                <div className="border-t border-gray-200 pt-6 space-y-4">
                    <h3 className="text-xl font-bold text-slate-800">معلومات الاتصال</h3>
                    <div className="flex items-center gap-2 flex-row-reverse">
                        <Phone size={20} className="text-slate-600" />
                        <span className="text-lg text-slate-700">01013055600</span>
                    </div>
                    <div className="flex items-start gap-2 flex-row-reverse">
                        <MapPin size={20} className="text-slate-600 flex-shrink-0 mt-1" />
                        <p className="text-lg text-slate-700">
                            برج الفردوس أمام مدرسة الزراعة قويسنا المنوفية
                        </p>
                    </div>
                </div>

                <div className="border-t border-gray-200 pt-6 space-y-4">
                    <h3 className="text-xl font-bold text-slate-800">تابعنا</h3>
                    <div className="flex flex-row-reverse gap-4">
                        <a href="https://www.facebook.com/BarcodestikersFactory?locale=ar_AR" target="_blank" rel="noopener noreferrer" className="p-3 rounded-full bg-slate-800 text-white hover:bg-slate-700 transition-colors">
                            <Facebook size={24} />
                        </a>
                        <a href="https://wa.me/201013055600" target="_blank" rel="noopener noreferrer" className="p-3 rounded-full bg-green-500 text-white hover:bg-green-600 transition-colors">
                            <MessageCircle size={24} />
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
);

const Footer = () => (
  <footer className="bg-slate-800 text-white py-8 rounded-t-xl mt-12">
    <div className="container mx-auto px-4 text-center">
      <p>&copy; 2024 Hitech Factory. All Rights Reserved.</p>
    </div>
  </footer>
);

const MobileMenu = ({ isOpen, onNavigate, onToggleMenu }) => {
  return (
    <div className={`fixed inset-0 z-[60] transform ${isOpen ? 'translate-x-0' : '-translate-x-full'} transition-transform duration-300 ease-in-out lg:hidden`}>
      <div className="absolute inset-0 bg-white shadow-xl flex flex-col p-8 text-right">
        <div className="flex justify-between items-center mb-8">
          <h2 className="text-2xl font-bold text-slate-800">القائمة</h2>
          <button onClick={onToggleMenu} className="text-gray-700">
            <X size={28} />
          </button>
        </div>
        <nav className="flex flex-col gap-4">
          <button onClick={() => { onNavigate('home'); onToggleMenu(); }} className="text-right text-lg font-medium text-slate-700 hover:text-slate-900 transition-colors">
            الرئيسية
          </button>
          <button onClick={() => { onNavigate('cart'); onToggleMenu(); }} className="text-right text-lg font-medium text-slate-700 hover:text-slate-900 transition-colors">
            سلة التسوق
          </button>
          <button onClick={() => { onNavigate('wishlist'); onToggleMenu(); }} className="text-right text-lg font-medium text-slate-700 hover:text-slate-900 transition-colors">
            قائمة المفضلة
          </button>
          <button onClick={() => { onNavigate('login'); onToggleMenu(); }} className="text-right text-lg font-medium text-slate-700 hover:text-slate-900 transition-colors">
            تسجيل الدخول
          </button>
          <button onClick={() => { onNavigate('aboutUs'); onToggleMenu(); }} className="text-right text-lg font-medium text-slate-700 hover:text-slate-900 transition-colors">
            عن المصنع
          </button>
          {initialMockData.categories.map(category => (
            <button
              key={category.id}
              onClick={() => { onNavigate('home', { categoryId: category.id }); onToggleMenu(); }}
              className="text-right text-lg font-medium text-slate-700 hover:text-slate-900 transition-colors"
            >
              {category.name_ar}
            </button>
          ))}
        </nav>
      </div>
      <div className="absolute inset-0 bg-black opacity-25 -z-10" onClick={onToggleMenu}></div>
    </div>
  );
};

function App() {
  const [view, setView] = useState('home');
  const [productId, setProductId] = useState(null);
  const [categoryId, setCategoryId] = useState(null);
  const [cart, setCart] = useState([]);
  const [wishlist, setWishlist] = useState([]);
  const [selectedCategory, setSelectedCategory] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [productsData, setProductsData] = useState(initialMockData.products);
  const [categoriesData, setCategoriesData] = useState(initialMockData.categories);
  const [pendingPayments, setPendingPayments] = useState([]);
  const [recommendedProducts, setRecommendedProducts] = useState([]);
  const [recommendationsLoading, setRecommendationsLoading] = useState(false);

  const navigate = (newView, params = {}) => {
    setView(newView);
    if (params.productId) {
      setProductId(params.productId);
    } else {
      setProductId(null);
    }
    if (params.categoryId) {
      setSelectedCategory(params.categoryId);
      setSearchQuery('');
    } else {
      setSelectedCategory(null);
    }
    setRecommendedProducts([]); // Clear recommendations on navigation
  };

  const handleSearch = (term) => {
    setSearchQuery(term);
    setSelectedCategory(null);
    setView('home');
  };

  const handleAddToCart = (product) => {
    setCart(prevCart => {
      const existingItem = prevCart.find(item => item.id === product.id);
      if (existingItem) {
        return prevCart.map(item =>
          item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
        );
      } else {
        return [...prevCart, { ...product, quantity: 1 }];
      }
    });
  };

  const handleUpdateQuantity = (productId, quantity) => {
    if (quantity <= 0) {
      handleRemoveItem(productId);
    } else {
      setCart(prevCart =>
        prevCart.map(item =>
          item.id === productId ? { ...item, quantity: quantity } : item
        )
      );
    }
  };

  const handleRemoveItem = (productId) => {
    setCart(prevCart => prevCart.filter(item => item.id !== productId));
  };

  const handleAddToWishlist = (productId) => {
    setWishlist(prevWishlist => {
      if (prevWishlist.includes(productId)) {
        return prevWishlist.filter(id => id !== productId);
      } else {
        return [...prevWishlist, productId];
      }
    });
  };

  const toggleMenu = () => {
    setIsMenuOpen(!isMenuOpen);
  };

  const handleAddProduct = (newProduct) => {
    setProductsData(prevProducts => [...prevProducts, newProduct]);
  };

  const handleDeleteProduct = (productId) => {
    setProductsData(prevProducts => prevProducts.filter(p => p.id !== productId));
  };
  
  const handleSaveProduct = (updatedProduct) => {
    setProductsData(prevProducts =>
        prevProducts.map(p => p.id === updatedProduct.id ? updatedProduct : p)
    );
  };
    
  const handleAddCategory = (newCategory) => {
    setCategoriesData(prevCategories => [...prevCategories, newCategory]);
  };
  
  const handleDeleteCategory = (categoryId) => {
      setCategoriesData(prevCategories => prevCategories.filter(c => c.id !== categoryId));
      setProductsData(prevProducts => prevProducts.map(p => p.categoryId === categoryId ? { ...p, categoryId: null } : p));
  };
  
  const handleSaveCategory = (updatedCategory) => {
    setCategoriesData(prevCategories =>
        prevCategories.map(c => c.id === updatedCategory.id ? updatedCategory : c)
    );
  };

  const handleProcessPayment = (paymentDetails) => {
    setPendingPayments(prevPayments => [...prevPayments, paymentDetails]);
  };

  const handleApprovePayment = (paymentId) => {
    setPendingPayments(prevPayments => prevPayments.filter(p => p.id !== paymentId));
    alert('تم شحن طلبك بنجاح!');
  };

  const handleCheckoutComplete = () => {
    setCart([]);
    navigate('home');
  };

  const getGeminiRecommendations = async (currentProduct) => {
    setRecommendationsLoading(true);
    const apiKey = "";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

    const allProductNames = productsData.map(p => p.name_ar).join(', ');
    const userQuery = `من قائمة المنتجات هذه: ${allProductNames}, اقترح لي 3 منتجات ذات صلة بالمنتج التالي: ${currentProduct}. أجب بأسماء المنتجات فقط، مفصولة بفاصلة.`;

    const payload = {
      contents: [{ parts: [{ text: userQuery }] }],
    };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
        
        if (text) {
            const recommendedNames = text.split(',').map(s => s.trim());
            const filtered = productsData.filter(p => recommendedNames.includes(p.name_ar) && p.name_ar !== currentProduct);
            setRecommendedProducts(filtered);
        }
    } catch (error) {
        console.error("Error fetching recommendations from Gemini API:", error);
    } finally {
        setRecommendationsLoading(false);
    }
  };

  const generateGeminiDescription = async (productName, categoryId) => {
    const apiKey = "";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
    
    const categoryName = categoriesData.find(c => c.id === categoryId)?.name_ar || '';
    const userQuery = `اكتب وصف منتج مقنعًا ومفصلاً باللغة العربية. اسم المنتج هو "${productName}" وينتمي إلى فئة "${categoryName}". يجب أن يركز الوصف على الجودة العالية والاستخدامات العملية للمنتج.`;

    const payload = {
      contents: [{ parts: [{ text: userQuery }] }],
    };
    
    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
        return text || "";
    } catch (error) {
        console.error("Error generating description from Gemini API:", error);
        return "فشل في إنشاء الوصف.";
    }
  };

  const filteredProducts = productsData.filter(product => {
    const matchesCategory = selectedCategory ? product.categoryId === selectedCategory : true;
    const matchesSearch = searchQuery ? product.name.toLowerCase().includes(searchQuery.toLowerCase()) || product.name_ar.toLowerCase().includes(searchQuery.toLowerCase()) : true;
    return matchesCategory && matchesSearch;
  });

  let content;
  switch (view) {
    case 'home':
      content = (
        <ProductList
          products={filteredProducts}
          onNavigate={navigate}
          onAddToCart={handleAddToCart}
          onAddToWishlist={handleAddToWishlist}
          categories={categoriesData}
          onFilter={categoryId => {
            setSelectedCategory(categoryId);
            setSearchQuery('');
          }}
          selectedCategory={selectedCategory}
          searchQuery={searchQuery}
          wishlist={wishlist}
        />
      );
      break;
    case 'product':
      const selectedProduct = productsData.find(p => p.id === productId);
      content = (
        <ProductDetail
          product={selectedProduct}
          onNavigate={navigate}
          onAddToCart={handleAddToCart}
          onAddToWishlist={handleAddToWishlist}
          isWishlisted={wishlist.includes(productId)}
          onGetRecommendations={getGeminiRecommendations}
          recommendedProducts={recommendedProducts}
          recommendationsLoading={recommendationsLoading}
        />
      );
      break;
    case 'wishlist':
        content = (
            <Wishlist
                products={productsData}
                onNavigate={navigate}
                onAddToCart={handleAddToCart}
                onAddToWishlist={handleAddToWishlist}
                wishlist={wishlist}
            />
        );
        break;
    case 'cart':
      content = (
        <Cart
          cart={cart}
          onNavigate={navigate}
          onUpdateQuantity={handleUpdateQuantity}
          onRemoveItem={handleRemoveItem}
          isLoggedIn={isLoggedIn}
          onCheckout={handleCheckoutComplete}
          onProcessPayment={handleProcessPayment}
        />
      );
      break;
    case 'login':
      content = <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
      break;
    case 'register':
      content = <Register onNavigate={navigate} />;
      break;
    case 'forgotPassword':
      content = <ForgotPassword onNavigate={navigate} />;
      break;
    case 'dashboard':
      content = isLoggedIn ? <SalesDashboard onLogout={() => setIsLoggedIn(false)} onNavigate={navigate} products={productsData} pendingPayments={pendingPayments} onApprovePayment={handleApprovePayment} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
      break;
    case 'productManagement':
        content = isLoggedIn ? <ProductManagement products={productsData} onNavigate={navigate} onEditProduct={(id) => navigate('editProduct', { productId: id })} onDeleteProduct={handleDeleteProduct} onAddProduct={handleAddProduct} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
        break;
    case 'addProduct':
        content = isLoggedIn ? <AddProduct onNavigate={navigate} onSave={handleAddProduct} categories={categoriesData} onGenerateDescription={generateGeminiDescription} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
        break;
    case 'categoryManagement':
        content = isLoggedIn ? <CategoryManagement categories={categoriesData} onNavigate={navigate} onEditCategory={(id) => {
          setCategoryId(id);
          setView('editCategory');
        }} onDeleteCategory={handleDeleteCategory} onAddCategory={handleAddCategory} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
        break;
    case 'addCategory':
        content = isLoggedIn ? <AddCategory onNavigate={navigate} onSave={handleAddCategory} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
        break;
    case 'editProduct':
        const productToEdit = productsData.find(p => p.id === productId);
        content = isLoggedIn && productToEdit ? <EditProduct product={productToEdit} onNavigate={navigate} onSave={handleSaveProduct} onGenerateDescription={generateGeminiDescription} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
        break;
    case 'editCategory':
        const categoryToEdit = categoriesData.find(c => c.id === categoryId);
        content = isLoggedIn && categoryToEdit ? <EditCategory category={categoryToEdit} onNavigate={navigate} onSave={handleSaveCategory} /> : <Login onLogin={setIsLoggedIn} onNavigate={navigate} />;
        break;
    case 'aboutUs':
        content = <AboutUs onNavigate={navigate} />;
        break;
    default:
      content = (
        <div className="container mx-auto p-4 pt-24 min-h-screen">
          <h1 className="text-4xl font-bold">404 - Page Not Found</h1>
        </div>
      );
  }

  return (
    <div className="font-sans bg-slate-50 text-slate-800 min-h-screen flex flex-col">
      <Header onNavigate={navigate} cartCount={cart.length} onSearch={handleSearch} onToggleMenu={toggleMenu} isLoggedIn={isLoggedIn} categories={categoriesData} wishlistCount={wishlist.length} />
      <MobileMenu isOpen={isMenuOpen} onNavigate={navigate} onToggleMenu={toggleMenu} />
      <main className="flex-grow">
        {content}
      </main>
      <Footer />
    </div>
  );
}

// Render the App component to the DOM
ReactDOM.createRoot(document.getElementById('root')).render(<App />);

</script>
</body>
</html>
